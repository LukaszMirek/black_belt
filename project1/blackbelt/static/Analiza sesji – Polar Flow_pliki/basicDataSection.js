BasicDataSection=function(){},BasicDataSection.prototype.init=function(a,t){var a=this;$.dispatcher.on("store.dataLoaded",function(a,t){swimmingSport=t.isSwimmingSport}),a.createClickEvents(),a.createVolumeTargetGraph(),this.ownTraining=!0,modal.register({element:"#basicDataPanelButton",url:"/training/ajaxAlertSaveConfirm",init:TrainingModal.bind(this,"onInit"),open:TrainingModal.bind(this,"onOpen"),close:TrainingModal.bind(this,"onClose")}),t()},BasicDataSection.prototype.windowResize=function(){this.windowWidth=$(window).width(),AppGlobal.screenWidth=document.documentElement.clientWidth},BasicDataSection.prototype.createClickEvents=function(){var a=this;$(".exercise-collapse").on("click",function(t){t.preventDefault();var e=$(this).html();$(this).html($(this).attr("data-text")),$(this).attr("data-text",e);var i=$(this).attr("ref"),n=$("#"+i);$(this).find("i").toggleClass("open");var s=$(".basic-data-panel").find("input.enableEditing");return n.hasClass("is-visible")?(a.windowResize(),0===$(".trainingpeaks-data-item-laps").length&&$("#trainingpeaks_analysis_disclaimer_text").hide(),n.removeClass("is-visible"),s.each(function(){$(this).removeClass("input-border visible").addClass("input-no-border hidden"),$(this).parent().addClass("hidden").removeClass("visible"),$(this).attr("readonly",!0),$(this).parents(".basic-data-panel__value").find(".basic-data-panel__value-container, .basic-data-panel__value-unit").show()}),""==$("#distanceStr").attr("value")&&$(".basic-data-panel__item.bdp-open").removeClass("bdp-open").addClass("hidden"),a.edited&&a.ownTraining&&$("#basicDataPanelButton").click()):(a.windowResize(),$(".trainingpeaks-data-item-basic").length>0&&$("#trainingpeaks_analysis_disclaimer_text").show(),n.addClass("is-visible"),s.each(function(){$(this).removeClass("input-no-border hidden").addClass("input-border visible"),$(this).parent().removeClass("hidden").addClass("visible"),$(this).removeAttr("readonly"),$(this).parents(".basic-data-panel__value").find(".basic-data-panel__value-container, .basic-data-panel__value-unit").hide()}),$(".basic-data-panel__item.hidden").removeClass("hidden").addClass("bdp-open")),!1}),$("#saveTraining").click(function(t){if(t.preventDefault(),!$(this).hasClass("disabled")&&a.ownTraining){var e=$("#duration").val(),i=$("#distanceStr").val(),n=$("#distance").val();e===$("#duration").attr("oldval")&&void 0!==e&&""!==e&&$("#duration").val($("#preciseDuration").val());var s=$("#sport").val();i===$("#distanceStr").attr("oldval")&&void 0!==i&&""!==i&&$("#distanceStr").val(CommonHelpers.metersToKm($("#preciseDistanceStr").val(),10)),$.ajax({url:"/api/sports/isSwimmingSport/"+s,type:"GET",dataType:"json",contentType:"application/json",success:function(a){if(swimmingSport?a?$("#distanceStr").val(CommonHelpers.round(i,10)):$("#distanceStr").val(CommonHelpers.metersToKm(i,10)):a&&$("#distanceStr").val(CommonHelpers.round(1e3*i,10)),void 0!==n&&""!==n){var t=Converter.Distance.convertForServer(n);$("#distance").val(t)}$("#bdForm").submit(),$("#duration").val(e)},error:function(t){spinner.reset(a),$.flashMessage(JSON.parse(t.responseText).responseText,"error")}})}return!1}),$("form#bdForm input.enableEditing, form#bdForm select, form#bdForm textarea").bind("keyup change",function(){$(this).val()==$(this).attr("oldval")?a.disableSaving():a.enableSaving(),$(this).parents(".basic-data-panel__value").find("basic-data-panel__value-container").html($(this).val())}),$("form#bdForm").on("focus","input.input-no-border",function(){$(this).blur()}),$("input.js-editable-exercise-value").on("focus",function(){var a=$(this).attr("data-id"),t=$(this).attr("data-column");$("#"+a+"_"+t+"_btn").removeClass("hidden")}),$(".js-exercise-btn").on("click",function(){var a=$(this);spinner.add(a);var t=a.attr("data-id"),e=a.attr("data-column"),i=$("#"+t+"_"+e),n=i.val().replace(",","."),s=i.attr("data-valuetype");if(isNaN(n))return $.flashMessage(Messages["error.invalid.number"],"error"),void spinner.reset(a);var r={id:t,column:e,value:n,valueType:s};$.ajax({url:"/training/exercise/singleData",data:JSON.stringify(r),type:"POST",dataType:"json",contentType:"application/json",success:function(t){spinner.reset(a);var e=CommonHelpers.metersToKm(t.trainingSession.distance,2);$("#BDPDistance").html(e),$.flashMessage(t.responseText,"success")},error:function(t){spinner.reset(a),$.flashMessage(JSON.parse(t.responseText).responseText,"error")}})})},BasicDataSection.prototype.enableSaving=function(){var a=this;$("#saveTraining").removeClass("disabled"),a.edited=!0},BasicDataSection.prototype.disableSaving=function(){var a=this;$("#saveTraining").addClass("disabled"),a.edited=!1},BasicDataSection.prototype.onInit=function(){},BasicDataSection.prototype.onOpen=function(){var a=this;$("#saveChanges").unbind("click"),$("#saveChanges").bind("click",function(){a.ownTraining&&($("#saveTraining").click(),$(".modal-close").trigger("click"))}),$("#cancelChanges").unbind("click"),$("#cancelChanges").bind("click",function(){$(".modal-close").trigger("click")})},BasicDataSection.prototype.onClose=function(){},BasicDataSection.prototype.createVolumeTargetGraph=function(){var a=$("#chart-volume-targets__progress");if(a&&a.length){var t={colors:{success:"#2fc16a",fail:"#d11f29",background:"#808080"},target:a.data("training-target")&&""!=a.data("training-target")?parseFloat(a.data("training-target")):100,result:a.data("training-result")&&""!=a.data("training-result")?parseFloat(a.data("training-result")):0,target_final:function(){return this.result&&this.target&&-(this.target-this.result).length>0?0:this.target-this.result},total_percent:function(){return Math.floor(this.result/this.target*100)},donut_color:function(){return t.target_final()<=0?this.colors.success:this.colors.fail}};!isNaN(parseFloat(t.total_percent()))&&isFinite(t.total_percent())&&($("#chart-volume-targets__value").html(t.total_percent()+"%"),a.highcharts({chart:{type:"pie"},title:!1,tooltip:!1,series:[{name:!1,data:[{name:"Result",y:t.result,color:t.donut_color()},{name:"Target",y:t.target_final(),color:t.colors.background}],size:46,innerSize:40,center:["50%","50%"],showInLegend:!1,dataLabels:{enabled:!1}}],credits:{enabled:!1}}))}};
//# sourceMappingURL=basicDataSection.min.js.map