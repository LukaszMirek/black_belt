$(function(){function n(n,e,i,t){$.ajax({type:"POST",url:"/training/changeTrainingSessionVisibility/"+n+"/"+e.getTrainingSessionId()}).success(function(e){var o=$("#trainingVisibilityValue");o.find("span").html(i),o.find("i").removeClass("icon icon-views-black icon-public icon-locked icon-followers"),o.find("i").addClass(t),"public"==n?$.flashMessage(Messages["analyseview.session_privacy.mouseover"],"info"):$.flashMessage(Messages["analyseview.visibility.changed.success"],"success")}).error(function(n){$.flashMessage(Messages["analyseview.visibility.changed.error"],"error")})}var e=$("#comments-content"),i=$("#coach-comments-content");new Flowtooltip({el:".tooltip-public",pos:"bottom",classes:"tooltip"});var t=function(){};t.Comment=function(){this.trainingSessionId=trainingSessionId,this.isFlowUser=isFlowUser,this.size="ALL"},t.Comment.prototype.getCommentsLikesCount=function(){$.ajax({type:"GET",url:"/social/training/"+Comment.getTrainingSessionId()+"/commentsCount",contentType:"application/json; charset=utf-8"}).done(function(n){n&&n.commentsCount&&$("#btn-comment-count").html(n.commentsCount)}).error(function(){$.flashMessage(Messages["error.unknown"],"error")}),$.ajax({type:"GET",url:"/social/training/"+Comment.getTrainingSessionId()+"/coachCommentsCount",contentType:"application/json; charset=utf-8"}).done(function(n){n&&n.commentsCount&&$("#tab-feed-item-count").html(n.commentsCount)}).error(function(){$.flashMessage(Messages["error.unknown"],"error")}),Comment.getIsFlowUser()&&$.ajax({type:"GET",url:"/social/training/"+Comment.getTrainingSessionId()+"/likesCount",contentType:"application/json; charset=utf-8"}).done(function(n){n&&n.likesCount&&$("#btn-like-count").text(n.likesCount)}).error(function(){$.flashMessage(Messages["error.unknown"],"error")})},t.Comment.prototype.checkTrainingSessionVisibility=function(){$.ajax({type:"GET",url:"/social/training/"+Comment.getTrainingSessionId()+"/visibility"}).done(function(n){if(n&&n.visibility){var e=n.visibility.toLowerCase(),i="",t="";"public"===e?(i=Messages["analyseview.visibility.public"],t="icon icon-views-black"):"followers"===e?(i=Messages["analyseview.visibility.followers"],t="icon icon-followers"):(i=Messages["analyseview.visibility.private"],t="icon icon-locked");var o=$("#trainingVisibilityValue");o.find("span").html(i),o.find("i").removeClass("icon icon-views-black icon-public icon-locked icon-followers"),o.find("i").addClass(t)}})},t.Comment.prototype.getTrainingSessionId=function(){return this.trainingSessionId},t.Comment.prototype.getIsFlowUser=function(){return this.isFlowUser},t.Comment.prototype.setTrainingSessionId=function(n){this.trainingSessionId=n},t.Comment.prototype.getSize=function(){return this.size},t.Comment.prototype.setSize=function(n){this.size=n},t.Comment.prototype.listComments=function(n,t){var o=$(".comments-holder"+(t?".coach-comments":".public-comments")).find(".ajax-loader");spinner.add(o);var s={type:"GET",url:"/social/training/"+Comment.getTrainingSessionId()+(t?"/coachcomments":"/comments")+"?size="+Comment.getSize(),dataType:"html",success:function(o){var s=t?i:e,a=s.find(".ui-comments-childs-wrapper"),c=a.prop("scrollHeight");a.animate({scrollTop:c},{duration:150});var r=$(o),m=r.find(".ui-comments-childs-wrapper > div.comment-item"),l=m.length;if(0===s.html().length){if(s.html(r),n){setTimeout(function(){a.animate({scrollTop:a.prop("scrollHeight")},{duration:150})},500)}var u=s.find(".ui-comments-btn-post"),d=s.find(".ui-comments-input-post"),f=function(n){n.preventDefault(),s.hasClass("activitySendingPost")||(s.addClass("activitySendingPost"),d.each(function(){var n=$.trim($(this).val());if(n.length>0){var e={type:"POST",url:"/social/training/"+Comment.getTrainingSessionId()+(t?"/coachcomments":"/comments"),data:JSON.stringify({text:n}),dataType:"json",contentType:"application/json; charset=utf-8",complete:function(){$(".activitySendingPost").removeClass("activitySendingPost")}};d.blur(),setTimeout(function(){$(window).scrollTop($(window).scrollTop()+1)},500),$.ajax(e).done(function(n){if(d.val(""),n===!0)return Comment.listComments(!1,t),!1;$.flashMessage(Messages["error.unknown"],"error")}).error(function(n){$.flashMessage(Messages["error.unknown"],"error")})}}))};u.unbind().bind("click",f),d.unbind().bind("keypress",function(n){13===n.which&&f(n)})}else{var p=[],g=[];s.find(".ui-comments-childs-wrapper li").each(function(){p.push($(this).data("ui-comments-comment-id"))}),m.each(function(){g.push($(this).data("ui-comments-comment-id"))}),"ALL"===Comment.getSize()&&s.find(".ui-comments-notification").length>0&&s.find(".ui-comments-notification").remove();for(var v=0;v<p.length;v++)0===r.find('[data-ui-comments-comment-id="'+p[v]+'"]').length&&s.find('[data-ui-comments-comment-id="'+p[v]+'"]').remove();for(var h=0;h<g.length;h++)0===s.find('[data-ui-comments-comment-id="'+g[h]+'"]').length&&s.find(".ui-comments-childs-wrapper").append(r.find('[data-ui-comments-comment-id="'+g[h]+'"]'))}$(t?"#tab-feed-item-count":"#btn-comment-count").html(l),s.find(".remove-post").unbind().bind("click",function(n){if(n.preventDefault(),!$(this).hasClass("activityRemovingPost")){$(this).addClass("activityRemovingPost");var e=$(this),i=e.parentsUntil("div.comment-item"),o=$(i).parent();Modal.open("/social/training/"+Comment.getTrainingSessionId()+"/comments/confirm?commentId="+o.data("ui-comments-comment-id"),{style:"narrow",callback:function(n){$(n).find(".preview").append(i.parent().find(".row").html()),$(n).find(".ui-comments-modal-delete").unbind().bind("click",function(n){if(n.preventDefault(),!$(this).hasClass("activityRemovingPost")){$(this).addClass("activityRemovingPost");var e={type:"DELETE",url:"/social/training/"+Comment.getTrainingSessionId()+(t?"/coachcomments":"/comments")+"/"+$(n.target).attr("data-ui-comments-comment-modal-id"),dataType:"json",contentType:"application/json; charset=utf-8"};$.ajax(e).done(function(n){if(Modal.close(),n===!0){var e=(setTimeout(function(){o.remove()},300),$(t?"#tab-feed-item-count":"#btn-comment-count")),i=parseInt(e.html(),10)-1;return i=i<0?0:i,e.html(i),0===i&&(0===s.find(".ui-comments-notification").length&&s.find(".ui-comments-wrapper").prepend('<div class="ui-comments-notification"></div>'),s.find(".ui-comments-notification").html(""),s.find(".ui-comments-notification").prepend("<p class='ui-comments-zero'>"+Messages["comments.be.the.first.one.exercise.user"]+"</p>")),!1}$.flashMessage(Messages["error.unknown"],"error"),$(".activityRemovingPost").removeClass("activityRemovingPost")}).error(function(n){$.flashMessage(Messages["error.unknown"],"error"),$(".activityRemovingPost").removeClass("activityRemovingPost")})}return!1}),$(n).find(".ui-comments-modal-cancel").unbind().bind("click",function(n){return n.preventDefault(),Modal.close(),$(".activityRemovingPost").removeClass("activityRemovingPost"),!1})}})}})},complete:function(){$(".activitySendingPost").removeClass("activitySendingPost"),$(".activityRemovingPost").removeClass("activityRemovingPost"),spinner.remove(o),navigator.userAgent.match(/(iPod|iPhone|iPad)/)||$(".ui-comments-childs-wrapper").slimScroll({height:"400px",wheelStep:2,start:"bottom"})}};$.ajax(s).error(function(n){$.flashMessage(Messages["error.unknown"],"error")})},Comment=new t.Comment,$("#btn-like").click(function(n){n.preventDefault();var e=$(this);Comment.getIsFlowUser()&&$.ajax({type:"POST",url:"/social/toggleLike",data:JSON.stringify({id:Comment.getTrainingSessionId()}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(n){var i=parseInt($("#btn-like-count").text(),10);return"boolean"==typeof n&&"true"===n.toString()?($("#btn-like-count").text(i+1),e.addClass("liked"),!1):"boolean"==typeof n&&"false"===n.toString()?(i-1>=0&&$("#btn-like-count").text(i-1),e.removeClass("liked"),!1):void $.flashMessage(Messages["error.unknown"],"error")})}),$("#public-comments, #coach-comments").on("click.bs.dropdown",function(n){n.preventDefault();var t=$(this);"public-comments"===t.attr("id")?(e.html(""),Comment.listComments(!0,!1)):"coach-comments"===t.attr("id")&&(i.html(""),Comment.listComments(!0,!0))}),$("#public-comments, #coach-comments").find(".dropdown-menu, .remove-post").on("click",function(n){n.preventDefault(),n.stopPropagation()}),$("#changeTrainingVisibility a").bind("click",function(e){e.preventDefault();var i=$(this).attr("ref"),t="",o="";return"public"===i?(t=Messages["analyseview.visibility.public"],o="icon icon-views-black"):"followers"===i?(t=Messages["analyseview.visibility.followers"],o="icon icon-followers"):(t=Messages["analyseview.visibility.private"],o="icon icon-locked"),n(i,Comment,t,o),$(this).dropdown("toggle"),!1}),Comment.getCommentsLikesCount()});
//# sourceMappingURL=social.min.js.map