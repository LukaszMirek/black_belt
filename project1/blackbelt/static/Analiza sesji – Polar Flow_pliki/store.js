Store=function(){this._mapData=null,this._curveData=null,this._rangeData=null,this._lapData=null,this._periodData=null,this._swimmingData=null,this._phasesData=null,this._racePaceData=null,this._speedZoneData=null,this._zonesJson=null,this._sampleStates={},this._sampleTypesSorted=[],this._zoneStates={},this._sportTypeSpeed=!0,this._isLapSelected=!1,this._isTrimModeEnabled=!1,this._isZoomed=!1,this._isDurationBased=!0,this._selectedLap=null,this._editableLapIndex=-1,this._phasesShown=!1,this._selectedPoint=null,this._selectionRange=null,this._selectedExercise=null,this._trainingSession=null,this._zoomEnabled=!0,this._enabledMarkers={},this._isSingleSport=!1,this._lapDataValues=null,this._isManualTrainingSession=!1,this._isSwimmingSport=null,this._isMobile=!1,AppGlobal.isMobile===!0&&(this._isMobile=!0)},Store.prototype.init=function(){function e(e,i){i||(h+=e.total,u++),e.lengthComputable&&(c+=i?e.loaded-i.loaded:e.loaded,u>=6&&t(c/h))}function t(e){e>=1&&(e=1),$("#progressPercent").html(Messages["reports.elements.not.ready.loadingText"]+" "+parseInt(100*e,10)+"&nbsp;%")}var i=function(t,i,s){if(t.indexOf("undefined")==-1){var n=$.Deferred();return $.ajax({xhr:function(){var t,i=new window.XMLHttpRequest;return i.addEventListener("progress",function(i){e(i,t),t=i},!1),i},url:t,context:this,success:function(e){i(("string"==typeof e||e instanceof String)&&e?JSON.parse(e):e)},error:function(){$.flashMessage(Messages["error.unknown"],"error")}}).done(function(){n.resolve()}).fail(function(){s?(i({}),n.resolve()):n.reject()}),n}},s=i("/training/analysis/"+trainingSessionId+"/curve/data",function(e){this._curveData=e,this._trainingSession=this.fixPowerSampleTypes(e),this._trainingSession.exercises.length<=1&&(this._selectedExercise=this._trainingSession.exercises[0]||void 0,this._sportTypeSpeed=this._trainingSession.exercises[0].sportTypeSpeed,this._isSingleSport=!0,this._isSwimmingSport=this._trainingSession.exercises[0].swimmingSport,this.checkEnabledMarkers(),this._selectedExercise.swimmingSport===!0&&this._selectedExercise.hasSwimmingSamples&&(this._isDurationBased=!1)),this._trainingSession.durationSamples&&0===this._trainingSession.durationSamples.length&&this._trainingSession.distanceSamples&&0===this._trainingSession.distanceSamples.length&&(this._isManualTrainingSession=!0)}.bind(this)),n=i("/training/analysis/"+trainingSessionId+"/map/data",function(e){this._mapData=e}.bind(this)),a=i("/training/analysis/"+trainingSessionId+"/lap/data",function(e){this._lapData=e}.bind(this)),r=i("/training/analysis/"+trainingSessionId+"/period/data",function(e){this._periodData=e}.bind(this),!0),o=i("/training/analysis/"+trainingSessionId+"/swimming/data",function(e){swimmingStatistics.setModel(e),this._swimmingData=e}.bind(this)),p=i("/training/analysis/"+trainingSessionId+"/phases/data",function(e){this._phasesData=e}.bind(this)),l=i("/training/analysis/"+trainingSessionId+"/racepace/data",function(e){this._racePaceData=e}.bind(this)),c=0,h=0,u=0;$.when(n,l).then(function(){useLeaflet?lMap.init(this._mapData):mapSection.init(this._mapData,initCounter)}.bind(this)),$.when(s,n,l,a,r,p,o).then(function(){this.generateHillZoneSamples(),mainInit(),initCounter(),$.dispatcher.trigger("store.dataLoaded",{isSingleSport:this._isSingleSport,isSwimmingSport:this._isSwimmingSport})}.bind(this)),this.registerEvents()},Store.prototype.registerEvents=function(){$.dispatcher.on("settings.sampleSet",function(e,t){this._sampleStates[t.sampleType]=t.state}.bind(this)),$.dispatcher.on("settings.zoneSet",function(e,t){this._zoneStates[t.sampleType]=t.state}.bind(this)),$.dispatcher.on("settings.toggleXAxis",function(e,t){this._isDurationBased=t.state}.bind(this)),$.dispatcher.on("lap.selectLap",function(e,t){this._selectionRange=t.selectionRange}.bind(this)),$.dispatcher.on("laps.selectLapType",function(e,t){this._lapDataValues=t.lapDataValues}.bind(this)),$.dispatcher.on("graph.zoom",function(e,t){this._isZoomed=!0,this._selectionRange=t.selectionRange}.bind(this)),$.dispatcher.on("graph.zoomReset",function(e,t){this._isZoomed=!1,this._selectioRange=null}.bind(this)),$.dispatcher.on("rangeSelector.updatedRange",function(e,t){this._selectionRange=t.selectionRange}.bind(this)),$.dispatcher.on("sportList.selectSport",function(e,t){this._selectedExercise=t.exercise,this._sportTypeSpeed=t.exercise.sportTypeSpeed,null!==t.exercise.distanceBasedSamples||this._isDurationBased||(this._isDurationBased=!0)}.bind(this)),$.dispatcher.on("sportList.unselectSport",function(e,t){this._selectedExercise=null,this._isDurationBased=!0,this._sportTypeSpeed=!0}.bind(this)),$.dispatcher.on("settings.markerSet",function(e,t){t.state?this._enabledMarkers[t.markerType]=!0:delete this._enabledMarkers[t.markerType]}.bind(this))},Store.prototype.checkEnabledMarkers=function(){hasTargetResult&&null!=exerciseTargetResults[this._selectedExercise.id]&&"PHASED"===exerciseTargetResults[this._selectedExercise.id].type?this._enabledMarkers.PHASED=!0:hasTargetResult&&null!=exerciseTargetResults[this._selectedExercise.id]&&"STEADY_RACE_PACE"===exerciseTargetResults[this._selectedExercise.id].type&&(this._enabledMarkers.STEADY_RACE_PACE=!0)},Store.prototype.generateHillZoneSamples=function(){var e=this;if(e._curveData.combinedHillZoneSamples=void 0,0!==Object.keys(e._periodData).length){var t=e._periodData.subperiods.filter(function(e){return"EXERCISE"===e.type}),i=[];if(t.forEach(function(e){var t=e.subperiods.filter(function(e){return"UPHILL"===e.type||"DOWNHILL"===e.type});t.length>0&&i.push([e.startTime.localDateTime,t])}),i.length>0){i.forEach(function(t){var i=e._curveData.exercises.filter(function(e){return e.startTime===t[0]});1===i.length&&(e.generateHillZoneSamplesForExercise(t[1],i[0]),i[0].hillData=t[1])});e._curveData.exercises.filter(function(e){return!e.durationBasedSamples.hasOwnProperty("HILLZONES")}).forEach(function(t){e.generateEmptyHillZoneSamplesForExercise(t)});var s=[];e._curveData.exercises.forEach(function(e){s=s.concat(e.durationBasedSamples.HILLZONES)}),e._curveData.combinedHillZoneSamples=s}}},Store.prototype.generateHillZoneSamplesForExercise=function(e,t){for(var i=[],s=!1,n=AnalysisHelpers.hillTypeToNumeric("FLAT"),a=0,r=t.durationBasedSamples.ALTITUDE[0],o=0;o<r.length;o++){var p=r[o][0];n=AnalysisHelpers.hillTypeToNumeric("FLAT"),p>=e[a].startTime.localDateTime&&p<e[a].endTime.localDateTime&&!s?n=AnalysisHelpers.hillTypeToNumeric(e[a].type):p>=e[a].endTime.localDateTime&&(a<e.length-1?a+=1:s=!0),i.push(n)}t.durationBasedSamples.HILLZONES=i},Store.prototype.generateEmptyHillZoneSamplesForExercise=function(e){var t=(e.durationBasedSamples,0);for(var i in e.durationBasedSamples)if(e.durationBasedSamples[i]&&e.durationBasedSamples[i][0]&&e.durationBasedSamples[i][0].length>0){t=e.durationBasedSamples[i][0].length;break}var s=Array(t).map(function(){return null});e.durationBasedSamples.HILLZONES=s},Store.prototype.fixPowerSampleTypes=function(e){var t=!1,i=!1,s=!1,n=!1;for(var a in e.sampleTypes)"LEFT_PEDAL_CRANK_BASED_POWER"===e.sampleTypes[a]?t=!0:"RIGHT_PEDAL_CRANK_BASED_POWER"===e.sampleTypes[a]?i=!0:"LEFT_PEDAL_CRANK_BASED_MAX_FORCE"===e.sampleTypes[a]||"RIGHT_PEDAL_CRANK_BASED_MAX_FORCE"===e.sampleTypes[a]||"LEFT_PEDAL_CRANK_BASED_MIN_FORCE"===e.sampleTypes[a]||"RIGHT_PEDAL_CRANK_BASED_MIN_FORCE"===e.sampleTypes[a]?0==s&&(e.sampleTypes.push("FORCE"),s=!0):"LEFT_PEDAL_CRANK_BASED_POSITIVE_FORCE"!==e.sampleTypes[a]&&"RIGHT_PEDAL_CRANK_BASED_POSITIVE_FORCE"!==e.sampleTypes[a]||0==n&&(e.sampleTypes.push("POSITIVE_FORCE"),n=!0);i!==!0&&t!==!0||e.sampleTypes.push("POWER"),i===!0&&t===!0&&e.sampleTypes.push("LEFT_RIGHT_BALANCE");for(var r in e.exercises){t=!1,i=!1,s=!1,n=!1;var o=e.exercises[r];for(var a in o.sampleTypes)"LEFT_PEDAL_CRANK_BASED_POWER"===o.sampleTypes[a]?t=!0:"RIGHT_PEDAL_CRANK_BASED_POWER"===o.sampleTypes[a]?i=!0:"LEFT_PEDAL_CRANK_BASED_MAX_FORCE"===o.sampleTypes[a]||"RIGHT_PEDAL_CRANK_BASED_MAX_FORCE"===o.sampleTypes[a]||"LEFT_PEDAL_CRANK_BASED_MIN_FORCE"===o.sampleTypes[a]||"RIGHT_PEDAL_CRANK_BASED_MIN_FORCE"===o.sampleTypes[a]?0==s&&(o.sampleTypes.push("FORCE"),s=!0):"LEFT_PEDAL_CRANK_BASED_POSITIVE_FORCE"!==o.sampleTypes[a]&&"RIGHT_PEDAL_CRANK_BASED_POSITIVE_FORCE"!==o.sampleTypes[a]||0==n&&(o.sampleTypes.push("POSITIVE_FORCE"),n=!0);i!==!0&&t!==!0||o.sampleTypes.push("POWER"),i===!0&&t===!0&&o.sampleTypes.push("LEFT_RIGHT_BALANCE")}return e},Store.prototype.sortSampleTypes=function(e){this._sampleStates={};var t=helpers.sortSampleTypes(e.sampleTypes),i=this._sportTypeSpeed?"PACE":"SPEED",s=t.indexOf(i);for(s>-1&&t.splice(s,1),this._sampleTypesSorted=t,j=0;j<t.length;j++)this._sampleStates[t[j]]=!1;for(var n=t.length>3?3:t.length,a=0;a<n;a++)"TEMPERATURE"!==t[a]&&(this._sampleStates[t[a]]=!0)},Store.prototype.getSampleTypesSorted=function(){return this._sampleTypesSorted},Store.prototype.getSampleStates=function(){return this._sampleStates},Store.prototype.getZoneStates=function(){return this._zoneStates},Store.prototype.getSportTypeSpeed=function(){return this._sportTypeSpeed},Store.prototype.getCurveData=function(){return this._curveData},Store.prototype.getLapData=function(){return this._lapData},Store.prototype.getPeriodData=function(){return this._periodData},Store.prototype.getHillDataForExercise=function(e){if(this._curveData.exercises.length>0){var t=this._curveData.exercises.filter(function(t){return t.id===Number(e)});if(t&&t.length>0&&t[0].hillData)return t[0].hillData}return[]},Store.prototype.getPerformanceTestData=function(){if(this._periodData&&this._periodData.subperiods){var e=this._periodData.subperiods.filter(function(e){return"EXERCISE"===e.type});if(1===e.length&&e[0].subperiods){var t=e[0].subperiods.filter(function(e){return"RUNNING_TEST"===e.type||"CYCLING_TEST"===e.type});if(t.length>0)return t}}return null},Store.prototype.getMapData=function(){return this._mapData},Store.prototype.getPhasesData=function(){return this._phasesData},Store.prototype.getRacePaceData=function(){return this._racePaceData},Store.prototype.getIsLapSelected=function(){return this._isLapSelected},Store.prototype.getIsTrimModeSelected=function(){return this._isTrimModeSelected},Store.prototype.getIsLapSelected=function(){return this._isLapSelected},Store.prototype.getIsZoomed=function(){return this._isZoomed},Store.prototype.getEditableLapIndex=function(){return this._editableLapIndex},Store.prototype.getPhasesShown=function(){return this._phasesShown},Store.prototype.getSelectedPoint=function(){return this._selectedPoint},Store.prototype.getSelectionRange=function(){return this._selectionRange},Store.prototype.getSelectedExercise=function(){return this._selectedExercise},Store.prototype.getTrainingSession=function(){return this._trainingSession},Store.prototype.getIsDurationBased=function(){return this._isDurationBased},Store.prototype.getZoomEnabled=function(){return this._zoomEnabled},Store.prototype.getIsMobile=function(){return this._isMobile},Store.prototype.getEnabledMarkers=function(){return this._enabledMarkers},Store.prototype.getIsTrimModeEnabled=function(){return this._isTrimModeEnabled},Store.prototype.getIsSingleSport=function(){return this._isSingleSport},Store.prototype.getLapDataValues=function(){return this._lapDataValues},Store.prototype.getIsManualTrainingSession=function(){return this._isManualTrainingSession},Store.prototype.getIsSwimmingSport=function(){return this._isSwimmingSport},Store.prototype.setZonesJson=function(e,t,i,s){this._zonesJson={HEART_RATE:e,POWER:t,FITFAT:i,SPEED:s}},Store.prototype.getZonesJson=function(){return this._zonesJson},Store.prototype.getExerciseTargetResults=function(){return exerciseTargetResults[this._selectedExercise.id]},Store.findByX=Functional.partial(Search.binarySearch,Functional.call(Search.compareProperty,Search.compareNumber,"x"),!1),Store.compareTime=Functional.call(Search.compareProperty,Search.compareNumber,0),Store.compareDistance=Functional.call(Search.compareProperty,Search.compareNumber,1),Store.findStartIndexByTime=Functional.partial(Search.binarySearch,Store.compareTime,!1),Store.findStopIndexByTime=Functional.partial(Search.binarySearch,Store.compareTime,!0),Store.findStartIndexByDistance=Functional.partial(Search.binarySearch,Store.compareDistance,!1),Store.findStopIndexByDistance=Functional.partial(Search.binarySearch,Store.compareDistance,!0);
//# sourceMappingURL=store.min.js.map